<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.9.3"/>
    <!--    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>-->
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea" style="width: 100%">
        <table cellspacing="0" cellpadding="0" style="margin-bottom: 1em; width: 100%">
            <tbody>
            <tr>
                <td id="projectlogo"><img alt="Logo" src="wrench-logo.png"/></td>
                <td id="projectalign" style="padding-left: 0.5em; margin-bottom: 1em; min-width: 270px">
                    <div id="projectname">WRENCH
                        &#160;<span id="projectnumber">2.0-dev</span>
                    </div>
                    <div id="projectbrief">Cyberinfrastructure Simulation Workbench</div>
                </td>
                <td style="vertical-align: bottom">
                    <a class="link" href="/wrench/2.0-dev/index.html">Overview</a>
                </td>
                <td style="vertical-align: bottom">
                    <a class="link" href="/wrench/2.0-dev/install.html">Installation</a>
                </td>
                <td style="vertical-align: bottom">
                    <a class="link" href="/wrench/2.0-dev/getting-started.html">Getting Started</a>
                </td>
                <td style="vertical-align: bottom">
                    <a class="link" href="/wrench/2.0-dev/wrench-101.html">WRENCH 101</a>
                </td>
                <td style="vertical-align: bottom">
                    <a class="link" href="/wrench/2.0-dev/wrench-102.html">WRENCH 102</a>
                </td>
                <td style="vertical-align: bottom">
                    <div class="dropdown">
                        <button class="dropbtn link">APIs Reference</button>
                        <div class="dropdown-content">
                            <a class="small dropdown-item link"
                               href="/wrench/2.0-dev/user/annotated.html">User</a>
                            <a class="small dropdown-item link"
                               href="/wrench/2.0-dev/developer/annotated.html">Developer</a>
                            <a class="small dropdown-item link"
                               href="/wrench/2.0-dev/internal/annotated.html">Internal</a>
                        </div>
                    </div>
                </td>
                <td style="float: right; min-width: 230px; padding-top: 1em">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
            </tr>
            </tbody>
        </table>
    </div>
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Interacting with a HTCondor compute service </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md__home_wrench_wrench_doc_wrench_102_htcondor"></a></p>
<p >A <code><a class="el" href="classwrench_1_1_h_t_condor_compute_service.html" title="A workload management framework compute service.">wrench::HTCondorComputeService</a></code> instance is essentially a front-end to several "child" compute services. As such, one can submit jobs to it, just like one would do to any compute service, but it then "decides" to which service these jobs will be delegated. In fact, an execution controller can even add new child compute services to be used by HTCondor dynamically. Which child service is used is dictated/influenced by service-specific arguments passed or not passed to the <code><a class="el" href="classwrench_1_1_job_manager.html#a97d2705f1e1d4a6453c1f93c9a578e0e" title="Submit a standard job to a compute service.">wrench::JobManager::submitJob()</a></code> method.</p>
<p >The examples code fragments below showcase the creation of a <code><a class="el" href="classwrench_1_1_h_t_condor_compute_service.html" title="A workload management framework compute service.">wrench::HTCondorComputeService</a></code> instance and its use by an execution controller. Let's start with the creation (in main). Note that arguments to service constructors are omitted for brevity (see the execution controller implementation in <code>examples/condor-grid-example/CondorWMS.cp</code> for a complete and working example).</p>
<div class="fragment"><div class="line"><span class="comment">// One BareMetalComputeService instance</span></div>
<div class="line">std::shared_ptr&lt;wrench::BareMetalComputeService&gt; some_baremetal_cs;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Two BatchComputeService instances</span></div>
<div class="line">std::shared_ptr&lt;wrench::BatchComputeService&gt; some_batch1_cs;</div>
<div class="line">std::shared_ptr&lt;wrench::BatchComputeService&gt; some_batch2_cs;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a HTCondorComputeService instance with the above </span></div>
<div class="line"><span class="comment">// three services as &quot;child&quot; services</span></div>
<div class="line"><span class="keyword">auto</span> htcondor_cs = simulation-&gt;add(</div>
<div class="line">     <span class="keyword">new</span> <a class="code hl_class" href="classwrench_1_1_h_t_condor_compute_service.html">wrench::HTCondorComputeService</a>(<span class="stringliteral">&quot;some_host&quot;</span>, </div>
<div class="line">                                        {some_baremetal_cs, some_batch1_cs, some_batch2_cs}, </div>
<div class="line">                                        <span class="stringliteral">&quot;/scratch&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// One CloudComputeService instance</span></div>
<div class="line">std::shared_ptr&lt;wrench::CloudComputeService&gt; somecloud_cs;</div>
<div class="ttc" id="aclasswrench_1_1_h_t_condor_compute_service_html"><div class="ttname"><a href="classwrench_1_1_h_t_condor_compute_service.html">wrench::HTCondorComputeService</a></div><div class="ttdoc">A workload management framework compute service.</div><div class="ttdef"><b>Definition:</b> HTCondorComputeService.h:27</div></div>
</div><!-- fragment --><p >Let's now say that an execution controller was created that has access to all 5 above services, but will choose to submit all jobs via HTCondor. The first thing to do, so as to make the use of the cloud service possible, is to create a few VM instances and add them as child services to the HTCondor service:</p>
<div class="fragment"><div class="line"><span class="comment">// Create and start to VMs on the cloud service</span></div>
<div class="line"><span class="keyword">auto</span> vm1 = some_cloud_cs-&gt;createVM(...);</div>
<div class="line"><span class="keyword">auto</span> vm2 = some_cloud_cs-&gt;createVM(...);</div>
<div class="line"><span class="keyword">auto</span> vm1_cs = some_cloud_cs-&gt;startVM(vm1); </div>
<div class="line"><span class="keyword">auto</span> vm2_cs = some_cloud_cs-&gt;startVM(vm2);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add the two VM&#39;s bare-metal compute services to HTCondor</span></div>
<div class="line">htcondor_cs-&gt;addComputeService(vm1_cs);</div>
<div class="line">htcondor_cs-&gt;addComputeService(vm2_cs);</div>
</div><!-- fragment --><p >So, at this point, HTCondor has access to 3 bare-metal compute services (2 of which are running inside VMs), and 2 batch compute services.</p>
<p >Let's consider an execution controller that will submit <code><a class="el" href="classwrench_1_1_standard_job.html" title="A standard (i.e., non-pilot) workflow job that can be submitted to a ComputeService by a WMS (via a J...">wrench::StandardJob</a></code> instances to HTCondor. These jobs can be of two kinds or, in HTCondor parlance, belong to one of two universes: <b>grid</b> jobs and <b>non-grid</b> jobs. By default a job is considered to be in the non-grid universe. But if the service-specific arguments passed to <code><a class="el" href="classwrench_1_1_job_manager.html#a97d2705f1e1d4a6453c1f93c9a578e0e" title="Submit a standard job to a compute service.">wrench::JobManager::submitJob()</a></code> include a "universe":"grid" key:value pair, then the submitted job is in the grid universe. HTCondor handles both kinds of jobs differently:</p>
<ul>
<li>Non-grid universe jobs are queued and dispatched by HTCondor whenever possible to idle resources managed by one of the child bare-metal services. HTCondor chooses the service to use based on availability of resources.</li>
<li>Grid universe jobs are dispatched by HTCondor immediately to a specific child batch compute service. As a result, these jobs must be submitted with service-specific arguments that provide values for "-N", "-c", and "-t" keys (like for any job submitted to a batch compute service), as well as a "-service" key that specifies the name of the batch service that should run the job (this argument is optional if there is a single child batch compute service).</li>
</ul>
<p >In the example below, we show both kinds of job submissions:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a standard job and submit it to HTCondor as a non-grid job,</span></div>
<div class="line"><span class="comment">// which will thus run it on one of its 3 child bare-metal compute services</span></div>
<div class="line"><span class="keyword">auto</span> ng_job = job_manager-&gt;createStandardJob(...);</div>
<div class="line">job_manager-&gt;submitJob(ng_job, htcondor_cs, {}); <span class="comment">// no service-specific arguments</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a standard job and submit it to HTCondor as a grid job,</span></div>
<div class="line"><span class="comment">// which will run it on the specified child batch compute service. </span></div>
<div class="line"><span class="keyword">auto</span> g_job = job_manager-&gt;createStandardJob(...);</div>
<div class="line"> </div>
<div class="line">std::map&lt;std::string, std::string&gt; service_specific_args;</div>
<div class="line">service_specific_args[<span class="stringliteral">&quot;-N&quot;</span>] = <span class="stringliteral">&quot;2&quot;</span>; <span class="comment">// 2 compute nodes</span></div>
<div class="line">service_specific_args[<span class="stringliteral">&quot;-c&quot;</span>] = <span class="stringliteral">&quot;4&quot;</span>; <span class="comment">// 4 cores per compute nodes</span></div>
<div class="line">service_specific_args[<span class="stringliteral">&quot;-t&quot;</span>] = <span class="stringliteral">&quot;60&quot;</span>; <span class="comment">// runs for one hour</span></div>
<div class="line">service_specific_args[<span class="stringliteral">&quot;universe&quot;</span>] = <span class="stringliteral">&quot;grid&quot;</span>; <span class="comment">// Grid universe</span></div>
<div class="line"><span class="comment">// Set it to run on the first batch compute service</span></div>
<div class="line">service_specific_args[<span class="stringliteral">&quot;-service&quot;</span>] = batch1_cs-&gt;getName(); </div>
<div class="line"> </div>
<div class="line">job_manager-&gt;submitJob(g_job, htcondor_cs, service_specific_args);</div>
</div><!-- fragment --><p >The above covers the essentials. See the API documnetation for more options, and the code in the <code>examples/condor-grid-example/</code> directory for working/usable code.</p>
<h1><a class="anchor" id="guide-htcondor-anatomy"></a>
Anatomy of the HTCondor Service</h1>
<p >The in-simulation implementation of HTCondor in WRENCH is simplified in terms of its functionality and design when compared to the actual implementation of HTCondor. The <code><a class="el" href="classwrench_1_1_h_t_condor_compute_service.html" title="A workload management framework compute service.">wrench::HTCondorComputeService</a></code> spawns two additional services during execution, <code><a class="el" href="classwrench_1_1_h_t_condor_central_manager_service.html" title="A HTCondor central manager service implementation.">wrench::HTCondorCentralManagerService</a></code> and <code><a class="el" href="classwrench_1_1_h_t_condor_negotiator_service.html" title="A HTCondor negotiator service.">wrench::HTCondorNegotiatorService</a></code>, both of which loosely correspond to actual HTCondor daemons (<code>collector</code>, <code>negotiator</code>, <code>schedd</code>). Their use is fully automated and transparent to the WRENCH developer. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
    <div style="float: left; width: 40%; padding-left: 2em; padding-bottom: 4em !important;">
        <p style="font-size: 0.8em"><strong>&copy;2017-2021 WRENCH. All Rights Reserved.</strong><br/></p>
        <p style="padding-top: 1em">
            <a href="mailto:support@wrench-project.org" class="fa-stack fa-2x" style="font-size: 1.5em">
                <i class="fa fa-circle fa-stack-2x icon-background"></i>
                <i class="fa fa-envelope fa-stack-1x"></i>
            </a>
            <a href="https://twitter.com/wrenchproject" target="_blank" class="fa-stack fa-2x"
               style="font-size: 1.5em">
                <i class="fa fa-circle fa-stack-2x icon-background"></i>
                <i class="fab fa-twitter fa-stack-1x"></i>
            </a>
            <a href="https://github.com/wrench-project/wrench" target="_blank" class="fa-stack fa-2x"
               style="font-size: 1.5em">
                <i class="fa fa-circle fa-stack-2x icon-background"></i>
                <i class="fab fa-github fa-stack-1x"></i>
            </a>
        </p>
    </div>
    <div style="float: right; width: 40%; padding-right: 2em">
        <p style="font-size: 0.8em">
            WRENCH is funded by the National Science Foundation (NSF) under grants number <a
                href="https://nsf.gov/awardsearch/showAward?AWD_ID=2103489" target="_blank">2103489</a>,
            <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=2103508" target="_blank">2103508</a>,
            <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1923539" target="_blank">1923539</a>, and
            <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1923621" target="_blank">1923621</a>;
            and the National Center for Scientific Research (CNRS) under grant number PICS07239.
        </p>
        <p style="font-weight: normal; font-size: 0.7em; margin-top: 1em">
            Any opinions, findings, and conclusions or recommendations expressed in this material are those
            of the author(s) and do not necessarily reflect the views of the National Science Foundation.
        </p>
    </div>
</div>
<!-- add the button to toggle the theme -->
<script>
    $(document).ready(function () {
        toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
        toggleButton.title = "Toggle Light/Dark Mode"
        document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
</script>
<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-18066333-6', 'auto');
    ga('send', 'pageview');
</script>
</body>
</html>
