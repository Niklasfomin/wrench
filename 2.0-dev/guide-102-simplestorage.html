<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.9.3"/>
    <!--    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>-->
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea" style="width: 100%">
        <table cellspacing="0" cellpadding="0" style="margin-bottom: 1em; width: 100%">
            <tbody>
            <tr>
                <td id="projectlogo"><img alt="Logo" src="wrench-logo.png"/></td>
                <td id="projectalign" style="padding-left: 0.5em; margin-bottom: 1em; min-width: 270px">
                    <div id="projectname">WRENCH
                        &#160;<span id="projectnumber">2.0-dev</span>
                    </div>
                    <div id="projectbrief">Cyberinfrastructure Simulation Workbench</div>
                </td>
                <td style="vertical-align: bottom">
                    <a class="link" href="/wrench/2.0-dev/index.html">Overview</a>
                </td>
                <td style="vertical-align: bottom">
                    <a class="link" href="/wrench/2.0-dev/install.html">Installation</a>
                </td>
                <td style="vertical-align: bottom">
                    <a class="link" href="/wrench/2.0-dev/getting-started.html">Getting Started</a>
                </td>
                <td style="vertical-align: bottom">
                    <a class="link" href="/wrench/2.0-dev/simulation-101.html">Simulation 101</a>
                </td>
                <td style="vertical-align: bottom">
                    <a class="link" href="/wrench/2.0-dev/wrench-101.html">WRENCH 101</a>
                </td>
                <td style="vertical-align: bottom">
                    <a class="link" href="/wrench/2.0-dev/wrench-102.html">WRENCH 102</a>
                </td>
                <td style="vertical-align: bottom">
                    <div class="dropdown">
                        <button class="dropbtn link">APIs Reference</button>
                        <div class="dropdown-content">
                            <a class="small dropdown-item link"
                               href="/wrench/2.0-dev/user/annotated.html">User</a>
                            <a class="small dropdown-item link"
                               href="/wrench/2.0-dev/developer/annotated.html">Developer</a>
                            <a class="small dropdown-item link"
                               href="/wrench/2.0-dev/internal/annotated.html">Internal</a>
                        </div>
                    </div>
                </td>
                <td style="float: right; min-width: 230px; padding-top: 1em">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
            </tr>
            </tbody>
        </table>
    </div>
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Interacting with a storage service </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md__home_wrench_wrench_doc_wrench_102_simplestorage"></a></p>
<p >Several interactions with a storage service are done simple by calling <b>static methods</b> of the <code><a class="el" href="classwrench_1_1_storage_service.html" title="The storage service base class.">wrench::StorageService</a></code> class. These make it possible to lookup, delete, read, and write files. For instance:</p>
<div class="fragment"><div class="line">std::shared_ptr&lt;wrench::SimpleStorageService&gt; storage_service;</div>
<div class="line"><span class="comment">// Get the file registry service</span></div>
<div class="line">std::shared_ptr&lt;wrench::FileRegistryService&gt; file_registry;</div>
<div class="line"> </div>
<div class="line">std::shared_ptr&lt;wrench::DataFile&gt; some_file;</div>
<div class="line"> </div>
<div class="line">[...]</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check whether the storage service holds the file at path /data/ and delete it if so</span></div>
<div class="line"><span class="keyword">auto</span> file_location = <a class="code hl_function" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service, <span class="stringliteral">&quot;/data/&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="classwrench_1_1_storage_service.html#a2114b6c15121078a40e48b4302e1e310">wrench::StorageService::lookupFile</a>(some_file, file_location) {</div>
<div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;File found!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  <a class="code hl_function" href="classwrench_1_1_storage_service.html#a07ded4afc6f7b801262e7b55f9de27ba">wrench::StorageService::deleteFile</a>(some_file, file_location, file_registry);</div>
<div class="line">}</div>
<div class="ttc" id="aclasswrench_1_1_file_location_html_ae62041d1dd72974f5edbb96fa9b73cb1"><div class="ttname"><a href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a></div><div class="ttdeci">static std::shared_ptr&lt; FileLocation &gt; LOCATION(std::shared_ptr&lt; StorageService &gt; ss)</div><div class="ttdoc">File location specifier for a storage service's (single) mount point root.</div><div class="ttdef"><b>Definition:</b> FileLocation.cpp:39</div></div>
<div class="ttc" id="aclasswrench_1_1_storage_service_html_a07ded4afc6f7b801262e7b55f9de27ba"><div class="ttname"><a href="classwrench_1_1_storage_service.html#a07ded4afc6f7b801262e7b55f9de27ba">wrench::StorageService::deleteFile</a></div><div class="ttdeci">static void deleteFile(std::shared_ptr&lt; DataFile &gt; file, std::shared_ptr&lt; FileLocation &gt; location, std::shared_ptr&lt; FileRegistryService &gt; file_registry_service=nullptr)</div><div class="ttdoc">Synchronously delete a file at a location.</div><div class="ttdef"><b>Definition:</b> StorageService.cpp:513</div></div>
<div class="ttc" id="aclasswrench_1_1_storage_service_html_a2114b6c15121078a40e48b4302e1e310"><div class="ttname"><a href="classwrench_1_1_storage_service.html#a2114b6c15121078a40e48b4302e1e310">wrench::StorageService::lookupFile</a></div><div class="ttdeci">static bool lookupFile(std::shared_ptr&lt; DataFile &gt; file, std::shared_ptr&lt; FileLocation &gt; location)</div><div class="ttdoc">Synchronously asks the storage service whether it holds a file.</div><div class="ttdef"><b>Definition:</b> StorageService.cpp:181</div></div>
</div><!-- fragment --><p >Note that the file registry service is passed to the <code><a class="el" href="classwrench_1_1_storage_service.html#a07ded4afc6f7b801262e7b55f9de27ba" title="Synchronously delete a file at a location.">wrench::StorageService::deleteFile()</a></code> method since the file deletion should cause the file registry to remove one of its entries.</p>
<p >Reading and writing files is something an execution controller typically does not do directly (instead, workflow tasks read and write files as they execute). But, if for some reason an execution controller needs to spend time doing file I/O, it is easily done:</p>
<div class="fragment"><div class="line"><span class="comment">// Read some file from the &quot;/&quot; path at some storage service. </span></div>
<div class="line"><span class="comment">// This does not change the simulation state besides simulating a time overhead during which the execution controller is busy</span></div>
<div class="line"><a class="code hl_function" href="classwrench_1_1_storage_service.html#af18acaa8ae7ee7e14de47dc5d9be4217">wrench::StorageService::readFile</a>(some_file, <a class="code hl_function" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service, <span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write some file to the &quot;/stuff/&quot; path at some storage service. </span></div>
<div class="line"><span class="comment">// This simulates a time overhead after which the storage service will host the file. It</span></div>
<div class="line"><span class="comment">// is a good idea to then add an entry to the file registry service</span></div>
<div class="line"><a class="code hl_function" href="classwrench_1_1_storage_service.html#aa4a9240b172b58ac9a08e65576e92d87">wrench::StorageService::writeFile</a>(some_file, <a class="code hl_function" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service, <span class="stringliteral">&quot;/stuff/&quot;</span>);</div>
<div class="ttc" id="aclasswrench_1_1_storage_service_html_aa4a9240b172b58ac9a08e65576e92d87"><div class="ttname"><a href="classwrench_1_1_storage_service.html#aa4a9240b172b58ac9a08e65576e92d87">wrench::StorageService::writeFile</a></div><div class="ttdeci">static void writeFile(std::shared_ptr&lt; DataFile &gt; file, std::shared_ptr&lt; FileLocation &gt; location)</div><div class="ttdoc">Synchronously write a file to the storage service.</div><div class="ttdef"><b>Definition:</b> StorageService.cpp:352</div></div>
<div class="ttc" id="aclasswrench_1_1_storage_service_html_af18acaa8ae7ee7e14de47dc5d9be4217"><div class="ttname"><a href="classwrench_1_1_storage_service.html#af18acaa8ae7ee7e14de47dc5d9be4217">wrench::StorageService::readFile</a></div><div class="ttdeci">static void readFile(std::shared_ptr&lt; DataFile &gt; file, std::shared_ptr&lt; FileLocation &gt; location)</div><div class="ttdoc">Synchronously read a file from the storage service.</div><div class="ttdef"><b>Definition:</b> StorageService.cpp:229</div></div>
</div><!-- fragment --><p >An operation commonly performed by an execution controller is copying files between storage services (e.g., to enforce some data locality). This is typically done by specifying file copy operations as part of standard jobs. But it can also be done manually by the execution controller via the data movement manager's methods <code><a class="el" href="classwrench_1_1_data_movement_manager.html#a851c3b5b836cbc5524363d04d36f3ab0" title="Ask the data manager to perform a synchronous file copy.">wrench::DataMovementManager::doSynchronousFileCopy()</a></code> and <code><a class="el" href="classwrench_1_1_data_movement_manager.html#a01f446e132a0819d5bd3ed334f56642e" title="Ask the data manager to initiate an asynchronous file copy.">wrench::DataMovementManager::initiateAsynchronousFileCopy()</a></code>. Here is an example in which a file is copied between storage services:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a data movement manager</span></div>
<div class="line"><span class="keyword">auto</span> data_movement_manager = this-&gt;createDataMovementManager();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Synchronously copy some_file from storage_service1 to storage_service2</span></div>
<div class="line"><span class="comment">// While this is taking place, the execution controller is busy</span></div>
<div class="line">data_movement_manager-&gt;doSynchronousFileCopy(some_file, <a class="code hl_function" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service1), <a class="code hl_function" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service2));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Asynchronously copy some_file from storage_service2 to storage_service3</span></div>
<div class="line">data_movement_manager-&gt;initiateAsynchronousFileCopy(some_file, <a class="code hl_function" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service2), <a class="code hl_function" href="classwrench_1_1_file_location.html#ae62041d1dd72974f5edbb96fa9b73cb1">wrench::FileLocation::LOCATION</a>(storage_service3));</div>
<div class="line"> </div>
<div class="line">[...]</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Wait for and process the next event (may be a file copy completion or failure)</span></div>
<div class="line">this-&gt;waitForAndProcessNextEvent();</div>
</div><!-- fragment --><p >See the execution controller implementation in <code>examples/basic-examples/bare-metal-data-movement/DataMovementWMS.cpp</code> for a more complete example. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
    <div style="float: left; width: 40%; padding-left: 2em; padding-bottom: 4em !important;">
        <p style="font-size: 0.8em"><strong>&copy;2017-2021 WRENCH. All Rights Reserved.</strong><br/></p>
        <p style="padding-top: 1em">
            <a href="mailto:support@wrench-project.org" class="fa-stack fa-2x" style="font-size: 1.5em">
                <i class="fa fa-circle fa-stack-2x icon-background"></i>
                <i class="fa fa-envelope fa-stack-1x"></i>
            </a>
            <a href="https://twitter.com/wrenchproject" target="_blank" class="fa-stack fa-2x"
               style="font-size: 1.5em">
                <i class="fa fa-circle fa-stack-2x icon-background"></i>
                <i class="fab fa-twitter fa-stack-1x"></i>
            </a>
            <a href="https://github.com/wrench-project/wrench" target="_blank" class="fa-stack fa-2x"
               style="font-size: 1.5em">
                <i class="fa fa-circle fa-stack-2x icon-background"></i>
                <i class="fab fa-github fa-stack-1x"></i>
            </a>
        </p>
    </div>
    <div style="float: right; width: 40%; padding-right: 2em">
        <p style="font-size: 0.8em">
            WRENCH is funded by the National Science Foundation (NSF) under grants number <a
                href="https://nsf.gov/awardsearch/showAward?AWD_ID=2103489" target="_blank">2103489</a>,
            <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=2103508" target="_blank">2103508</a>,
            <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1923539" target="_blank">1923539</a>, and
            <a href="https://nsf.gov/awardsearch/showAward?AWD_ID=1923621" target="_blank">1923621</a>;
            and the National Center for Scientific Research (CNRS) under grant number PICS07239.
        </p>
        <p style="font-weight: normal; font-size: 0.7em; margin-top: 1em">
            Any opinions, findings, and conclusions or recommendations expressed in this material are those
            of the author(s) and do not necessarily reflect the views of the National Science Foundation.
        </p>
    </div>
</div>
<!-- add the button to toggle the theme -->
<script>
    $(document).ready(function () {
        toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
        toggleButton.title = "Toggle Light/Dark Mode"
        document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
</script>
<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-18066333-6', 'auto');
    ga('send', 'pageview');
</script>
</body>
</html>
